<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:CatalogoApp.UI.Converters"
             xmlns:models="clr-namespace:CatalogoApp.Core.Entidades;assembly=CatalogoApp.Core"
             x:Class="CatalogoApp.UI.Views.ContentViews.ArticulosView">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:NullToBoolConverter x:Key="NullToBoolConverter" />
            <converters:CountToBoolConverter x:Key="CountToBoolConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="3*,1*">

        <!--Sección de filtros avanzados.-->

        <Border Grid.Row="0" Grid.ColumnSpan="2" 
        StrokeShape="RoundRectangle 10" 
        BackgroundColor="{StaticResource White}" 
        Padding="15" Margin="20,20,20,0">
            <Grid ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Picker Grid.Column="0" Title="Campo" 
                ItemsSource="{Binding ListaDeCampos}" 
                SelectedItem="{Binding CampoSeleccionado}" />

                <Picker Grid.Column="1" Title="Criterio"
                ItemsSource="{Binding ListaDeCriterios}" 
                SelectedItem="{Binding CriterioSeleccionado}" />

                <Grid Grid.Column="2">
                    <Label Text="Valor"></Label>
                    <Entry Placeholder="Valor..." 
                        PlaceholderColor="{StaticResource Gray400}" 
                        TextColor="{StaticResource PrimaryTextColor}"
                        FontSize="14"
                        Background="Transparent"
                        VerticalOptions="End"
                        Margin="0,29,0,0"
                        Text="{Binding ValorFiltro}"
                        IsEnabled="{Binding EstaHabilitadoEntryValor}"
                    />

                </Grid>

                <Button Grid.Column="3" MaximumHeightRequest="60" VerticalOptions="End" Text="Aplicar" Command="{Binding AplicarFiltrosCommand}" />
                <Button Grid.Column="4" MaximumHeightRequest="60" VerticalOptions="End" Text="Limpiar" Command="{Binding LimpiarFiltrosCommand}" />
            </Grid>
        </Border>



        <!--row título y buscador-->
        <Grid Grid.Row="1" Grid.ColumnSpan="2"
              Margin="20,20,20,10"
              ColumnDefinitions="*,Auto">

            <Label Grid.Column="0"
               Text="Artículos" 
               FontSize="28" 
               FontAttributes="Bold" 
               TextColor="{StaticResource AccentColor}" 
               VerticalOptions="Center" />

            <!--filtro rápido-->
            <SearchBar Grid.Column="1" Placeholder="Buscar artículos..." 
                       PlaceholderColor="{StaticResource Gray400}" 
                       TextColor="{StaticResource PrimaryTextColor}"
                       FontSize="14"
                       Background="White"
                       HeightRequest="45"
                       WidthRequest="300"
                       VerticalOptions="Center"
                       Text="{Binding ValorFiltroRapido}" />
        </Grid>


        <!--tabla-->
        <Border Grid.Row="2" Grid.Column="0"
                x:Name="TablaArticulos"
                StrokeShape="RoundRectangle 15"
                Stroke="{StaticResource Secondary}"
                BackgroundColor="White"
                Margin="20,0,10,20"
                Padding="0"
                Grid.ColumnSpan="1"
                >
            <!--cambiar propiedades visuales de un control en función de un valor de datos (binding).-->
            <Border.Triggers>
                <DataTrigger TargetType="Border"
                     Binding="{Binding ArticuloSeleccionado, Converter={StaticResource NullToBoolConverter}}"
                     Value="False">
                    <!-- No hay artículo seleccionado -->
                    <Setter Property="Grid.ColumnSpan" Value="2" />
                </DataTrigger>
                <DataTrigger TargetType="Border"
                     Binding="{Binding ArticuloSeleccionado, Converter={StaticResource NullToBoolConverter}}"
                     Value="True">
                    <!-- Hay artículo seleccionado -->
                    <Setter Property="Grid.ColumnSpan" Value="1" />
                </DataTrigger>
            </Border.Triggers>


            <Grid RowDefinitions="Auto,*" Padding="20">

                <!--encabezado-->
                <Grid Grid.Row="0"
                      ColumnDefinitions="*,*,*,*,*,*,*"
                      Padding="0,0,0,10"
                      ColumnSpacing="10"
                      
                      >
                    <Label Grid.Column="0" Text="Código" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="1" Text="Nombre" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="2" Text="Descripción" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="3" Text="Marca" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="4" Text="Categoría" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="5" Text="Precio" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                    <Label Grid.Column="6" TextType="Text" Text="Acciones" FontAttributes="Bold" TextColor="{StaticResource PrimaryTextColor}" />
                </Grid>

                <Border BackgroundColor="{StaticResource Secondary}" Margin="0, 30, 0, 0" HeightRequest="1" />

                <!--Lista-->
                <CollectionView Grid.Row="1" x:Name="ArticulosCollection"
                                ItemsSource="{Binding Articulos}"
                                SelectedItem="{Binding ArticuloSeleccionado, Mode=TwoWay}"
                                SelectionMode="Single"
                                >
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="*,*,*,*,*,*,Auto" Padding="10,15" ColumnSpacing="10">
                                <Label Grid.Column="0" Text="{Binding Codigo}" />
                                <Label Grid.Column="1" Text="{Binding Nombre}" />
                                <Label Grid.Column="2" Text="{Binding Descripcion}" />
                                <Label Grid.Column="3" Text="{Binding Marca.Descripcion}" />
                                <Label Grid.Column="4" Text="{Binding Categoria.Descripcion}" />
                                <Label Grid.Column="5" Text="{Binding Precio}" />

                                <!-- Nueva columna de acciones -->
                                <HorizontalStackLayout Grid.Column="6" Spacing="10">
                                    <Button HeightRequest="32"
                                            WidthRequest="80"
                                            FontSize="12"
                                            Padding="6,0" Text="Editar" />
                                    <Button HeightRequest="32"
                                            WidthRequest="80"
                                            FontSize="12"
                                            Padding="6,0" Text="Eliminar" />
                                </HorizontalStackLayout>


                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>

            </Grid>

        </Border>

        <!--Detalle articulo-->


        <Border Grid.Row="2" Grid.Column="1"
                StrokeShape="RoundRectangle 15"
                Stroke="{StaticResource Secondary}"
                BackgroundColor="White"
                Margin="10,0,20,20"
                Padding="20"
                IsVisible="{Binding ArticuloSeleccionado, Converter={StaticResource NullToBoolConverter}}"
                >
            <ScrollView>
                <VerticalStackLayout Spacing="10">

                    <!--Imagenes-->
                    <VerticalStackLayout>

                        <Grid>
                            <Image x:Name="MainImage"
                       Aspect="AspectFit"
                       HeightRequest="350" Source="{Binding ImagenMostrada.UrlImagen}"/>

                            <!-- Flechas para cambiar imagen -->
                            <Button Text="&lt;" Command="{Binding ImagenAnteriorCommand}"
                    VerticalOptions="Center" HorizontalOptions="Start"
                    WidthRequest="40" HeightRequest="40" IsVisible="{Binding EstanVisiblesBotones}" />

                            <Button Text=">" Command="{Binding ImagenSiguienteCommand}"
                            VerticalOptions="Center" HorizontalOptions="End"
                            WidthRequest="40" HeightRequest="40" IsVisible="{Binding EstanVisiblesBotones}" />
                        </Grid>

                        <!-- Indicador tipo "1 / N" -->
                        <Label x:Name="ImageCounterLabel"
                       HorizontalOptions="Center"
                       FontAttributes="Bold"
                       Text="{Binding ContadorImagenes}" IsVisible="{Binding EstanVisiblesBotones}"/>
                    </VerticalStackLayout>

                    <!--<Image Source="{Binding ArticuloSeleccionado.Imagenes[0].UrlImagen}" HeightRequest="350" />-->
                    <Label Text="{Binding ArticuloSeleccionado.Nombre}" FontSize="20" FontAttributes="Bold"/>
                    <Label Text="{Binding ArticuloSeleccionado.Descripcion}" FontSize="14" TextColor="Gray"/>
                    <Label Text="{Binding ArticuloSeleccionado.Marca.Descripcion}" />
                    <Label Text="{Binding ArticuloSeleccionado.Categoria.Descripcion}" />
                    <Label Text="{Binding ArticuloSeleccionado.Precio, StringFormat='Precio: ${0:F2}'}" FontAttributes="Bold" />
                </VerticalStackLayout>
            </ScrollView>
        </Border>



    </Grid>


</ContentView>
